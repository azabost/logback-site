<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <style>
      body {
        max-width: 85em;
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 1.5rem;
        grid-template-areas:
           'empty0     headerArea   empty1'
           'leftArea   contentArea  rightArea';
      }

      #header {
        margin-left: 1em;
        grid-area: headerArea;
      }
      #left {
         grid-area: leftArea;
      }

      #content {
         max-width: 58em;      
         grid-area: contentArea;
         margin: 1em;
      }

      #right {
         grid-area: rightArea;
      }

      @media (max-width: 30em) {
        body {
          grid-template-areas:
           'headerArea  headerArea headerArea'
           'leftArea    rightArea   rightArea'
           'contentArea contentArea contentArea';
        }                   
      }
    </style>
  </head>
  <body>

    <div id="header">
      <p>this is the dheader</p>
    </div>

    <div id="left">
      <ul>
        <li>hello</li>
        <li>hello</li>
        <li>hello</li>
        <li>asd;lkfjasdflk; </li>        
      </ul>
    </div>

    <div id="right">
            <ul>
        <li>hello</li>
        <li>hello</li>
        <li>hello</li>
        <li>asd;lkfjasdflk; </li>        
      </ul>

    </div>

    <div id="content">

      <p class="big red">This xx chapter is outdated and needs to be
      re-written to account for the massive changes occurring in
      1.3</p>
    
      <p>Joran stands for a cold north-west wind which, every now and
      then, blows forcefully on Lake Geneva. Located right in the
      middle of Western-Europe, the surface of Lake Geneva is smaller
      than many other European lakes. However, with its average depth
      of 153 meters, it is unusually deep, and happens to be, by
      volume, the largest sweet water reserve in Western-Europe.
      </p>


      <p>As apparent in previous chapters, logback relies on Joran, a
      mature, flexible and powerful configuration framework. Many of
      the capabilities offered by logback modules are only possible on
      account of Joran. This chapter focuses on Joran, its basic
      design and its salient features.
      </p>

      <p>Joran is actually a generic configuration system which can be
      used independently of logging. To emphasize this point, we
      should mention that the logback-core module does not have a
      notion of loggers. In that spirit, most of the examples in this
      chapter have nothing to do with loggers, appenders or layouts.
      </p>

      <p>The examples presented in this chapter can be found under
      <em>LOGBACK_HOME/logback-examples/src/main/java/chapters/onJoran/</em>
      folder.
      </p>

      <p>To install Joran, simply <a
      href="../download.html">download</a> logback and add
      <em>logback-core-${project.version}.jar</em> to your
      classpath.</p>
    
      <h2 class="doAnchor">Historical perspective</h2>

      <p>Reflection is a powerful feature of the Java language, making
      it possible to configure software systems declaratively. For
      example, many important properties of an EJB are configured with
      the <em>ejb.xml</em> file. While EJBs are written in Java, many
      of their properties are specified within the <em>ejb.xml</em>
      file. Similarly, logback settings can be specified in a
      configuration file, expressed in XML format. Annotations
      available in JDK 1.5 and heavily used in EJB 3.0 replace many
      directives previously found in XML files. Joran also makes use
      of annotations but at a much smaller extent. Due to the dynamic
      nature of logback configuration data (compared to EJBs) Joran's
      use of annotations is rather limited.
    </p>

    <p>In log4j, logback's predecessor, the
    <code>DOMConfigurator</code> class, which is part of log4j version
    1.2.x and later, could also parse configuration files written in
    XML. <code>DOMConfigurator</code> was written in a way that forced
    us, the developers, to tweak the code each time the structure of
    the configuration file changed. The modified code had to be
    recompiled and redeployed. Just as importantly, the code of the
    <code>DOMConfigurator</code> consisted of loops dealing with
    child elements containing many interspersed if/else
    statements. One could not help but notice that this particular
    code reeked of redundancy and duplication.  The <a
    href="http://jakarta.apache.org/commons/digester/">commons-digester
    project</a> had shown us that it was possible to parse XML files
    using pattern matching rules. At parse time, digester would apply
    rules that matched designated patterns. Rule classes were usually
    quite small and specialized. Consequently, they were relatively
    easy to understand and maintain.
    </p>

    <p>Armed with the <code>DOMConfigurator</code> experience, we
    began developing <code>Joran</code>, a powerful configuration
    framework to be used in logback. Joran was largely inspired by the
    commons-digester project. Nevertheless, it uses a slightly
    different terminology. In commons-digester, a rule can be seen as
    consisting of a pattern and a rule, as shown by the
    <code>Digester.addRule(String pattern, Rule rule)</code>
    method. We find it unnecessarily confusing to have a rule to
    consist of itself, not recursively but with a different
    meaning. In Joran, a rule consists of a pattern and an action. An
    action is invoked when a match occurs for the corresponding
    pattern. This relation between patterns and actions lies at the
    core of Joran.  Quite remarkably, one can deal with quite complex
    requirements by using simple patterns, or more precisely with
    exact matches and wildcard matches.
    </p>

    <h3 class="doAnchor" name="saxOrDom">SAX or DOM?</h3>

    <p>Due to the event-based architecture of the SAX API, a tool based
    on SAX cannot easily deal with forward references, that is,
    references to elements which are defined later than the current
    element being processed. Elements with cyclical references are
    equally problematic. More generally, the DOM API allows the user to
    perform searches on all the elements and make forward jumps.
    </p>
    
    <p>This extra flexibility initially led us to choose the DOM API
    as the underlying parsing API for Joran. After some
    experimentation, it quickly became clear that dealing with jumps
    to distant elements while parsing the DOM tree did not make sense
    when the interpretation rules were expressed in the form of
    patterns and actions. <em>Joran only needs to be given the
    elements in the XML document in a sequential, depth-first
    order.</em>
    </p>

    <p>Moreover, the SAX API offers element location information which
    allows Joran to display the exact line and column number where an
    error occurred. Location information comes in very handy in the
    identification of parsing problems.
    </p>
    
    <h3>Non goals</h3>

    <p>Given its highly dynamic nature, the Joran API is not intended
    to be used to parse very large XML documents with many thousands
    of elements.
    </p>

    </div>
    
    
  </body>
</html>
